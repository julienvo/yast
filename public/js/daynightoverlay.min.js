/**
 * @license Copyright 2011 â€” 2015 Martin Matysiak.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
!function(t,e){if("object"==typeof module&&"object"==typeof module.exports)module.exports=e();else if("function"==typeof define&&"object"==typeof define.amd)define(["goog!maps,3,other_params:[sensor=false&libraries=visualization]"],e);else{if("object"!=typeof google||"object"!=typeof google.maps)throw new Error("DayNightOverlay requires google maps library");t.DayNightOverlay=e()}}("undefined"!=typeof window?window:this,function(){var t=function(t){t=t||{},this.canvas_=null,this.fillColor_=t.fillColor||"rgba(0,0,0,0.5)",this.id_=t.id||null,this.date_=t.date||null,"undefined"!=typeof t.map&&this.setMap(t.map),this.smallZoomThreshold=t.smallZoomThreshold||3};return t.prototype=new google.maps.OverlayView,t.NORTH_=new google.maps.LatLng(85,0),t.SOUTH_=new google.maps.LatLng(-85,0),t.prototype.onAdd=function(){this.canvas_=document.createElement("canvas"),this.canvas_.style.position="absolute",this.id_&&(this.canvas_.id=this.id_),this.getPanes().overlayLayer.appendChild(this.canvas_)},t.prototype.onRemove=function(){this.canvas_.parentNode.removeChild(this.canvas_),this.canvas_=null},t.prototype.draw=function(){var t=this.getProjection(),e=this.getWorldDimensions_(t),i=this.getVisibleDimensions_(t,250);this.getMap().getZoom()<this.smallZoomThreshold&&(i.x=e.x-e.width,i.y=e.y,i.width=3*e.width,i.height=e.height),this.canvas_.style.left=i.x+"px",this.canvas_.style.top=i.y+"px",this.canvas_.style.width=i.width+"px",this.canvas_.style.height=i.height+"px",this.canvas_.width=i.width,this.canvas_.height=i.height;var a=this.canvas_.getContext("2d");a.clearRect(0,0,i.width,i.height);var o=this.createTerminatorFunc_(i,e),n=this.isNorthernSun_(this.date_?this.date_:new Date);a.fillStyle=this.fillColor_,a.beginPath(),a.moveTo(0,n?i.height:0);for(var s=0;s<i.width;s++)a.lineTo(s,o(s));a.lineTo(i.width,n?i.height:0),a.fill()},t.prototype.setDate=function(t){this.date_=t,null!==this.canvas_&&this.draw()},t.prototype.getWorldDimensions_=function(e){var i=e.fromLatLngToDivPixel(t.NORTH_),a=e.fromLatLngToDivPixel(t.SOUTH_),o=e.getWorldWidth();return{x:i.x-o/2,y:i.y,width:o,height:a.y-i.y}},t.prototype.getVisibleDimensions_=function(t,e){var i=t.fromLatLngToDivPixel(this.getMap().getBounds().getNorthEast()),a=t.fromLatLngToDivPixel(this.getMap().getBounds().getSouthWest());return{x:a.x-e,y:i.y-e,width:i.x-a.x+2*e,height:a.y-i.y+2*e}},t.prototype.createTerminatorFunc_=function(t,e){var i=this.date_?this.date_:new Date,a=2*Math.PI,o=e.width,n=e.height,s=e.height/2,h=(t.width,t.height),r=t.x-e.x,l=t.y-e.y,g=a/o,d=n/Math.PI,p=3600*i.getUTCHours()+60*i.getUTCMinutes()+i.getUTCSeconds(),c=43200,u=a/86400,y=(p+c)*u,f=this.getDayOfYear_(i),m=this.getDayOfYear_(new Date(Date.UTC(i.getFullYear(),2,20))),_=23.44*Math.PI/90,v=Math.sin(a*(f-m)/365)*_;return function(t){var e=(t+r)*g+y,i=Math.atan(-Math.cos(e)/Math.tan(v));return i=s+i*d,Math.min(h,Math.max(0,i-l))}},t.prototype.isNorthernSun_=function(t){var e=new Date(Date.UTC(t.getFullYear(),2,19)),i=new Date(Date.UTC(t.getFullYear(),8,18));return t.getTime()>e.getTime()&&t.getTime()<=i.getTime()},t.prototype.getDayOfYear_=function(t){var e=new Date(Date.UTC(t.getFullYear(),0,1));return Math.ceil((t.getTime()-e.getTime())/864e5)},t});